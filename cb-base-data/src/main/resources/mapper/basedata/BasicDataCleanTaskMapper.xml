<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cb.basedata.mapper.BasicDataCleanTaskMapper">
    
    <resultMap type="BasicDataCleanTask" id="BasicDataCleanTaskResult">
        <result property="taskId"    column="task_id"    />
        <result property="taskName"    column="task_name"    />
        <result property="sourceTable"    column="source_table"    />
        <result property="targetTable"    column="target_table"    />
        <result property="enabled"    column="enabled"    />
        <result property="delFlag"    column="del_flag"    />
        <result property="createBy"    column="create_by"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateBy"    column="update_by"    />
        <result property="updateTime"    column="update_time"    />
        <result property="remark"    column="remark"    />
    </resultMap>

    <resultMap id="BasicDataCleanTaskBasicDataCleanTaskRelationResult" type="BasicDataCleanTask" extends="BasicDataCleanTaskResult">
        <collection property="basicDataCleanTaskRelationList" notNullColumn="relation_id" javaType="java.util.List" resultMap="BasicDataCleanTaskRelationResult" />
    </resultMap>

    <resultMap type="BasicDataCleanTaskRelation" id="BasicDataCleanTaskRelationResult">
        <result property="relationId"    column="relation_id"    />
        <result property="cleanTaskId"    column="clean_task_id"    />
        <result property="sourceColumn"    column="source_column"    />
        <result property="targetColumn"    column="target_column"    />
        <result property="enableClean"    column="enable_clean"    />
        <result property="aiModeCode"    column="ai_mode_code"    />
    </resultMap>

    <sql id="selectBasicDataCleanTaskVo">
        select task_id, task_name, source_table, target_table, enabled, del_flag, create_by, create_time, update_by, update_time, remark from basic_data_clean_task
    </sql>

    <select id="selectBasicDataCleanTaskList" parameterType="BasicDataCleanTask" resultMap="BasicDataCleanTaskResult">
        <include refid="selectBasicDataCleanTaskVo"/>
        <where>  
            <if test="taskName != null  and taskName != ''"> and task_name like concat('%', #{taskName}, '%')</if>
            <if test="sourceTable != null  and sourceTable != ''"> and source_table = #{sourceTable}</if>
            <if test="targetTable != null  and targetTable != ''"> and target_table = #{targetTable}</if>
            <if test="enabled != null  and enabled != ''"> and enabled = #{enabled}</if>
        </where>
    </select>
    
    <select id="selectBasicDataCleanTaskById" parameterType="String" resultMap="BasicDataCleanTaskBasicDataCleanTaskRelationResult">
        select a.task_id, a.task_name, a.source_table, a.target_table, a.enabled, a.del_flag, a.create_by, a.create_time, a.update_by, a.update_time, a.remark,
            b.relation_id, b.clean_task_id, b.source_column, b.target_column, b.enable_clean, b.ai_mode_code
        from basic_data_clean_task a
        left join basic_data_clean_task_relation b on b.clean_task_id = a.task_id
        where a.task_id = #{taskId}
    </select>
        
    <insert id="insertBasicDataCleanTask" parameterType="BasicDataCleanTask">
        insert into basic_data_clean_task
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="taskId != null and taskId != ''">task_id,</if>
            <if test="taskName != null and taskName != ''">task_name,</if>
            <if test="sourceTable != null and sourceTable != ''">source_table,</if>
            <if test="targetTable != null and targetTable != ''">target_table,</if>
            <if test="enabled != null and enabled != ''">enabled,</if>
            <if test="delFlag != null">del_flag,</if>
            <if test="createBy != null">create_by,</if>
            <if test="createTime != null">create_time,</if>
            <if test="updateBy != null">update_by,</if>
            <if test="updateTime != null">update_time,</if>
            <if test="remark != null">remark,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="taskId != null and taskId != ''">#{taskId},</if>
            <if test="taskName != null and taskName != ''">#{taskName},</if>
            <if test="sourceTable != null and sourceTable != ''">#{sourceTable},</if>
            <if test="targetTable != null and targetTable != ''">#{targetTable},</if>
            <if test="enabled != null and enabled != ''">#{enabled},</if>
            <if test="delFlag != null">#{delFlag},</if>
            <if test="createBy != null">#{createBy},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateBy != null">#{updateBy},</if>
            <if test="updateTime != null">#{updateTime},</if>
            <if test="remark != null">#{remark},</if>
         </trim>
    </insert>

    <update id="updateBasicDataCleanTask" parameterType="BasicDataCleanTask">
        update basic_data_clean_task
        <trim prefix="SET" suffixOverrides=",">
            <if test="taskName != null and taskName != ''">task_name = #{taskName},</if>
            <if test="sourceTable != null and sourceTable != ''">source_table = #{sourceTable},</if>
            <if test="targetTable != null and targetTable != ''">target_table = #{targetTable},</if>
            <if test="enabled != null and enabled != ''">enabled = #{enabled},</if>
            <if test="delFlag != null">del_flag = #{delFlag},</if>
            <if test="createBy != null">create_by = #{createBy},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            <if test="updateTime != null">update_time = #{updateTime},</if>
            <if test="remark != null">remark = #{remark},</if>
        </trim>
        where task_id = #{taskId}
    </update>


    <delete id="deleteBasicDataCleanTaskById" parameterType="String">
        delete from basic_data_clean_task where task_id = #{taskId}
    </delete>

    <delete id="deleteBasicDataCleanTaskByIds" parameterType="String">
        delete from basic_data_clean_task where task_id in 
        <foreach item="taskId" collection="array" open="(" separator="," close=")">
            #{taskId}
        </foreach>
    </delete>
    
    <delete id="deleteBasicDataCleanTaskRelationByCleanTaskIds" parameterType="String">
        delete from basic_data_clean_task_relation where clean_task_id in 
        <foreach item="cleanTaskId" collection="array" open="(" separator="," close=")">
            #{cleanTaskId}
        </foreach>
    </delete>

    <delete id="deleteBasicDataCleanTaskRelationByCleanTaskId" parameterType="String">
        delete from basic_data_clean_task_relation where clean_task_id = #{cleanTaskId}
    </delete>

    <insert id="batchBasicDataCleanTaskRelation">
        insert into basic_data_clean_task_relation( relation_id, clean_task_id, source_column, target_column, enable_clean, ai_mode_code) values
		<foreach item="item" index="index" collection="list" separator=",">
            ( #{item.relationId}, #{item.cleanTaskId}, #{item.sourceColumn}, #{item.targetColumn}, #{item.enableClean}, #{item.aiModeCode})
        </foreach>
    </insert>
</mapper>